{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rubenbernardes/Code/freelance/volvo/azure-context/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rubenbernardes/Code/freelance/volvo/azure-context/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{PublicClientApplication}from'@azure/msal-browser';import{APP_ID,AZURE_AUTHORITY,SCOPES}from'../../config/environment';var MSAL_CONFIG={auth:{clientId:APP_ID,redirectUri:window.location.origin,authority:AZURE_AUTHORITY,postLogoutRedirectUri:window.location.origin}};export var azureProvider=new PublicClientApplication(MSAL_CONFIG);export var scopeRequestConfig={scopes:['user.read','mailboxsettings.read','calendars.readwrite']};export var getAccessToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var allAccounts,silentResult,interactiveResult,_allAccounts;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:allAccounts=azureProvider.getAllAccounts();_context.prev=1;if(!((allAccounts===null||allAccounts===void 0?void 0:allAccounts.length)<=0)){_context.next=4;break;}throw new Error('login_required');case 4:_context.next=6;return azureProvider.acquireTokenSilent({scopeRequestConfig:scopeRequestConfig,account:allAccounts[0]});case 6:silentResult=_context.sent;return _context.abrupt(\"return\",{token:silentResult.accessToken,idToken:silentResult.idToken,account:allAccounts[0]});case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);if(!isInteractionNeeded(_context.t0)){_context.next=20;break;}_context.next=15;return azureProvider.loginPopup(scopeRequestConfig);case 15:interactiveResult=_context.sent;_allAccounts=azureProvider.getAllAccounts();return _context.abrupt(\"return\",{token:interactiveResult.accessToken,idToken:interactiveResult.idToken,account:_allAccounts[0]});case 20:throw _context.t0;case 21:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function getAccessToken(){return _ref.apply(this,arguments);};}();export var isInteractionNeeded=function isInteractionNeeded(error){if(!error.message||error.message.length<=0){return false;}return error.message.indexOf('consent_required')>-1||error.message.indexOf('interaction_required')>-1||error.message.indexOf('login_required')>-1||error.message.indexOf('no_account_in_silent_request')>-1;};export var parseJwt=function parseJwt(token){var base64Url=token.split('.')[1];var base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');var jsonPayload=decodeURIComponent(atob(base64).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));return JSON.parse(jsonPayload);};export var getRolesFromParsedJwt=function getRolesFromParsedJwt(parsedJWT){if((parsedJWT===null||parsedJWT===void 0?void 0:parsedJWT.roles)instanceof Array){var _parsedJWT$roles$;return parsedJWT===null||parsedJWT===void 0?void 0:(_parsedJWT$roles$=parsedJWT.roles[0])===null||_parsedJWT$roles$===void 0?void 0:_parsedJWT$roles$.toUpperCase();}else{var _parsedJWT$roles;return parsedJWT===null||parsedJWT===void 0?void 0:(_parsedJWT$roles=parsedJWT.roles)===null||_parsedJWT$roles===void 0?void 0:_parsedJWT$roles.toUpperCase();}};","map":{"version":3,"sources":["/Users/rubenbernardes/Code/freelance/volvo/azure-context/src/utils/security/security.util.js"],"names":["PublicClientApplication","APP_ID","AZURE_AUTHORITY","SCOPES","MSAL_CONFIG","auth","clientId","redirectUri","window","location","origin","authority","postLogoutRedirectUri","azureProvider","scopeRequestConfig","scopes","getAccessToken","allAccounts","getAllAccounts","length","Error","acquireTokenSilent","account","silentResult","token","accessToken","idToken","isInteractionNeeded","loginPopup","interactiveResult","error","message","indexOf","parseJwt","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","getRolesFromParsedJwt","parsedJWT","roles","Array","toUpperCase"],"mappings":"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","sourcesContent":["import { PublicClientApplication } from '@azure/msal-browser';\nimport { APP_ID, AZURE_AUTHORITY, SCOPES } from '../../config/environment';\n\nconst MSAL_CONFIG = {\n  auth: {\n    clientId: APP_ID,\n    redirectUri: window.location.origin,\n    authority: AZURE_AUTHORITY,\n    postLogoutRedirectUri: window.location.origin,\n  },\n};\n\nexport const azureProvider = new PublicClientApplication(MSAL_CONFIG);\nexport const scopeRequestConfig = {\n  scopes: ['user.read','mailboxsettings.read','calendars.readwrite']\n};\n\nexport const getAccessToken = async () => {\n  const allAccounts = azureProvider.getAllAccounts();\n  try {\n    if (allAccounts?.length <= 0) throw new Error('login_required');\n    const silentResult = await azureProvider.acquireTokenSilent({\n      scopeRequestConfig,\n      account: allAccounts[0]\n    });\n\n    return {\n      token: silentResult.accessToken,\n      idToken: silentResult.idToken,\n      account: allAccounts[0]\n    }\n  } catch (err) {\n    if (isInteractionNeeded(err)) {\n      const interactiveResult = await azureProvider.loginPopup(scopeRequestConfig);\n      const allAccounts = azureProvider.getAllAccounts();\n\n      return {\n        token: interactiveResult.accessToken,\n        idToken: interactiveResult.idToken,\n        account: allAccounts[0]\n      }\n    } else {\n      throw err;\n    }\n  }\n}\n\nexport const isInteractionNeeded = (error) => {\n  if (!error.message || error.message.length <= 0) {\n    return false;\n  }\n\n  return (\n    error.message.indexOf('consent_required') > -1 ||\n    error.message.indexOf('interaction_required') > -1 ||\n    error.message.indexOf('login_required') > -1 ||\n    error.message.indexOf('no_account_in_silent_request') > -1\n  );\n};\n\nexport const parseJwt = (token) => {\n  const base64Url = token.split('.')[1];\n  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n\n  return JSON.parse(jsonPayload);\n};\n\nexport const getRolesFromParsedJwt = (parsedJWT) => {\n  if (parsedJWT?.roles instanceof Array) {\n    return parsedJWT?.roles[0]?.toUpperCase();\n  } else{\n    return parsedJWT?.roles?.toUpperCase();\n  }\n}"]},"metadata":{},"sourceType":"module"}