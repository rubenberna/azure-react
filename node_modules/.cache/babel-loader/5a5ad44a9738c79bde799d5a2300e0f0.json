{"ast":null,"code":"import { PublicClientApplication } from '@azure/msal-browser';\nimport { APP_ID, REDIRECT_URI, SCOPES } from '../config/environment';\nconst MSAL_CONFIG = {\n  auth: {\n    clientId: APP_ID,\n    redirectUri: REDIRECT_URI,\n    postLogoutRedirectUri: REDIRECT_URI\n  }\n};\nexport const azureProvider = new PublicClientApplication(MSAL_CONFIG);\nexport const scopeRequestConfig = {\n  scopes: SCOPES.split(',')\n};\nexport const getAccessToken = async () => {\n  const allAccounts = azureProvider.getAllAccounts();\n\n  try {\n    if ((allAccounts === null || allAccounts === void 0 ? void 0 : allAccounts.length) <= 0) throw new Error('login_required');\n    const silentResult = await azureProvider.acquireTokenSilent({\n      scopeRequestConfig,\n      account: allAccounts[0]\n    });\n    console.log(silentResult);\n    return {\n      token: silentResult.accessToken,\n      account: allAccounts[0]\n    };\n  } catch (err) {\n    if (isInteractionNeeded(err)) {\n      const interactiveResult = await azureProvider.loginPopup(scopeRequestConfig);\n      const allAccounts = azureProvider.getAllAccounts();\n      return {\n        token: interactiveResult.accessToken,\n        account: allAccounts[0]\n      };\n    } else {\n      throw err;\n    }\n  }\n};\nexport const isInteractionNeeded = error => {\n  if (!error.message || error.message.length <= 0) {\n    return false;\n  }\n\n  return error.message.indexOf('consent_required') > -1 || error.message.indexOf('interaction_required') > -1 || error.message.indexOf('login_required') > -1 || error.message.indexOf('no_account_in_silent_request') > -1;\n};\nexport const parseJwt = token => {\n  const base64Url = token.split('.');\n  console.log(token);\n  return base64Url; // const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  // const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n  //   return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  // }).join(''));\n  // return JSON.parse(jsonPayload);\n};","map":{"version":3,"sources":["/Users/rubenbernardes/Code/freelance/volvo/azure-context/src/utils/security.util.js"],"names":["PublicClientApplication","APP_ID","REDIRECT_URI","SCOPES","MSAL_CONFIG","auth","clientId","redirectUri","postLogoutRedirectUri","azureProvider","scopeRequestConfig","scopes","split","getAccessToken","allAccounts","getAllAccounts","length","Error","silentResult","acquireTokenSilent","account","console","log","token","accessToken","err","isInteractionNeeded","interactiveResult","loginPopup","error","message","indexOf","parseJwt","base64Url"],"mappings":"AAAA,SAASA,uBAAT,QAAwC,qBAAxC;AACA,SAASC,MAAT,EAAiBC,YAAjB,EAA+BC,MAA/B,QAA6C,uBAA7C;AAEA,MAAMC,WAAW,GAAG;AAClBC,EAAAA,IAAI,EAAE;AACJC,IAAAA,QAAQ,EAAEL,MADN;AAEJM,IAAAA,WAAW,EAAEL,YAFT;AAGJM,IAAAA,qBAAqB,EAAEN;AAHnB;AADY,CAApB;AAQA,OAAO,MAAMO,aAAa,GAAG,IAAIT,uBAAJ,CAA4BI,WAA5B,CAAtB;AACP,OAAO,MAAMM,kBAAkB,GAAG;AAChCC,EAAAA,MAAM,EAAER,MAAM,CAACS,KAAP,CAAa,GAAb;AADwB,CAA3B;AAIP,OAAO,MAAMC,cAAc,GAAG,YAAY;AACxC,QAAMC,WAAW,GAAGL,aAAa,CAACM,cAAd,EAApB;;AACA,MAAI;AACF,QAAI,CAAAD,WAAW,SAAX,IAAAA,WAAW,WAAX,YAAAA,WAAW,CAAEE,MAAb,KAAuB,CAA3B,EAA8B,MAAM,IAAIC,KAAJ,CAAU,gBAAV,CAAN;AAC9B,UAAMC,YAAY,GAAG,MAAMT,aAAa,CAACU,kBAAd,CAAiC;AAC1DT,MAAAA,kBAD0D;AAE1DU,MAAAA,OAAO,EAAEN,WAAW,CAAC,CAAD;AAFsC,KAAjC,CAA3B;AAKAO,IAAAA,OAAO,CAACC,GAAR,CAAYJ,YAAZ;AAEA,WAAO;AACLK,MAAAA,KAAK,EAAEL,YAAY,CAACM,WADf;AAELJ,MAAAA,OAAO,EAAEN,WAAW,CAAC,CAAD;AAFf,KAAP;AAID,GAbD,CAaE,OAAOW,GAAP,EAAY;AACZ,QAAIC,mBAAmB,CAACD,GAAD,CAAvB,EAA8B;AAC5B,YAAME,iBAAiB,GAAG,MAAMlB,aAAa,CAACmB,UAAd,CAAyBlB,kBAAzB,CAAhC;AACA,YAAMI,WAAW,GAAGL,aAAa,CAACM,cAAd,EAApB;AAEA,aAAO;AACLQ,QAAAA,KAAK,EAAEI,iBAAiB,CAACH,WADpB;AAELJ,QAAAA,OAAO,EAAEN,WAAW,CAAC,CAAD;AAFf,OAAP;AAID,KARD,MAQO;AACL,YAAMW,GAAN;AACD;AACF;AACF,CA5BM;AA8BP,OAAO,MAAMC,mBAAmB,GAAIG,KAAD,IAAW;AAC5C,MAAI,CAACA,KAAK,CAACC,OAAP,IAAkBD,KAAK,CAACC,OAAN,CAAcd,MAAd,IAAwB,CAA9C,EAAiD;AAC/C,WAAO,KAAP;AACD;;AAED,SACEa,KAAK,CAACC,OAAN,CAAcC,OAAd,CAAsB,kBAAtB,IAA4C,CAAC,CAA7C,IACAF,KAAK,CAACC,OAAN,CAAcC,OAAd,CAAsB,sBAAtB,IAAgD,CAAC,CADjD,IAEAF,KAAK,CAACC,OAAN,CAAcC,OAAd,CAAsB,gBAAtB,IAA0C,CAAC,CAF3C,IAGAF,KAAK,CAACC,OAAN,CAAcC,OAAd,CAAsB,8BAAtB,IAAwD,CAAC,CAJ3D;AAMD,CAXM;AAaP,OAAO,MAAMC,QAAQ,GAAIT,KAAD,IAAW;AACjC,QAAMU,SAAS,GAAGV,KAAK,CAACX,KAAN,CAAY,GAAZ,CAAlB;AACAS,EAAAA,OAAO,CAACC,GAAR,CAAYC,KAAZ;AAEA,SAAOU,SAAP,CAJiC,CAKjC;AACA;AACA;AACA;AACA;AACD,CAVM","sourcesContent":["import { PublicClientApplication } from '@azure/msal-browser';\nimport { APP_ID, REDIRECT_URI, SCOPES } from '../config/environment';\n\nconst MSAL_CONFIG = {\n  auth: {\n    clientId: APP_ID,\n    redirectUri: REDIRECT_URI,\n    postLogoutRedirectUri: REDIRECT_URI,\n  },\n};\n\nexport const azureProvider = new PublicClientApplication(MSAL_CONFIG);\nexport const scopeRequestConfig = {\n  scopes: SCOPES.split(',')\n};\n\nexport const getAccessToken = async () => {\n  const allAccounts = azureProvider.getAllAccounts();\n  try {\n    if (allAccounts?.length <= 0) throw new Error('login_required');\n    const silentResult = await azureProvider.acquireTokenSilent({\n      scopeRequestConfig,\n      account: allAccounts[0]\n    });\n\n    console.log(silentResult);\n\n    return {\n      token: silentResult.accessToken,\n      account: allAccounts[0]\n    }\n  } catch (err) {\n    if (isInteractionNeeded(err)) {\n      const interactiveResult = await azureProvider.loginPopup(scopeRequestConfig);\n      const allAccounts = azureProvider.getAllAccounts();\n\n      return {\n        token: interactiveResult.accessToken,\n        account: allAccounts[0]\n      }\n    } else {\n      throw err;\n    }\n  }\n}\n\nexport const isInteractionNeeded = (error) => {\n  if (!error.message || error.message.length <= 0) {\n    return false;\n  }\n\n  return (\n    error.message.indexOf('consent_required') > -1 ||\n    error.message.indexOf('interaction_required') > -1 ||\n    error.message.indexOf('login_required') > -1 ||\n    error.message.indexOf('no_account_in_silent_request') > -1\n  );\n};\n\nexport const parseJwt = (token) => {\n  const base64Url = token.split('.');\n  console.log(token);\n\n  return base64Url\n  // const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  // const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n  //   return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  // }).join(''));\n  // return JSON.parse(jsonPayload);\n};"]},"metadata":{},"sourceType":"module"}