{"ast":null,"code":"import { PublicClientApplication } from '@azure/msal-browser';\nimport { APP_ID, REDIRECT_URI, SCOPES } from '../config/environment';\nexport const MSAL_CONFIG = {\n  auth: {\n    clientId: APP_ID,\n    redirectUri: REDIRECT_URI\n  },\n  cache: {\n    cacheLocation: \"sessionStorage\",\n    storeAuthStateInCookie: true\n  }\n};\nconst scopes = ['user.read', 'mailboxsettings.read', 'calendars.readwrite'];\nexport const scopeRequestConfig = {\n  scopes: SCOPES.split(',')\n};\nexport const azureProvider = new PublicClientApplication(MSAL_CONFIG);\n\nconst normalizeError = error => {\n  let normalizedError = {};\n\n  if (typeof error === 'string') {\n    const errParts = error.split('|');\n    normalizedError = errParts.length > 1 ? {\n      message: errParts[1],\n      debug: errParts[0]\n    } : {\n      message: error\n    };\n  } else {\n    normalizedError = {\n      message: error.message,\n      debug: JSON.stringify(error)\n    };\n  }\n\n  return normalizedError;\n};\n\nconst isInteractionNeeded = error => {\n  if (!error.message || error.message.length <= 0) {\n    return false;\n  }\n\n  return error.message.indexOf('consent_required') > -1 || error.message.indexOf('interaction_required') > -1 || error.message.indexOf('login_required') > -1 || error.message.indexOf('no_account_in_silent_request') > -1;\n};\n\nexport const getAccessToken = async props => {\n  console.log(props); // try {\n  //   const silentResult = await azureProvider.acquireTokenSilent({\n  //     scopes: scopes,\n  //     account: account\n  //   });\n  //   return silentResult.accessToken;\n  // } catch (err) {\n  //   if (isInteractionNeeded(err)) {\n  //     const interactiveResult = await azureProvider.acquireTokenPopup({\n  //       scopes: scopes\n  //     });\n  //\n  //     return interactiveResult.accessToken;\n  //   } else {\n  //     throw err;\n  //   }\n  // }\n};\nexport const getUserProfile = async () => {\n  try {\n    const accessToken = await getAccessToken(scopes);\n\n    if (accessToken) {\n      return {\n        isAuthenticated: true,\n        user: {},\n        error: {\n          message: \"Access token:\",\n          debug: accessToken\n        }\n      };\n    }\n  } catch (err) {\n    return {\n      isAuthenticated: false,\n      user: {},\n      error: normalizeError(err)\n    };\n  }\n};","map":{"version":3,"sources":["/Users/rubenbernardes/Code/freelance/volvo/azure-context/src/utils/security.util.js"],"names":["PublicClientApplication","APP_ID","REDIRECT_URI","SCOPES","MSAL_CONFIG","auth","clientId","redirectUri","cache","cacheLocation","storeAuthStateInCookie","scopes","scopeRequestConfig","split","azureProvider","normalizeError","error","normalizedError","errParts","length","message","debug","JSON","stringify","isInteractionNeeded","indexOf","getAccessToken","props","console","log","getUserProfile","accessToken","isAuthenticated","user","err"],"mappings":"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","sourcesContent":["import { PublicClientApplication } from '@azure/msal-browser';\nimport { APP_ID, REDIRECT_URI, SCOPES } from '../config/environment'\n\nexport const MSAL_CONFIG = {\n  auth: {\n    clientId: APP_ID,\n    redirectUri: REDIRECT_URI\n  },\n  cache: {\n    cacheLocation: \"sessionStorage\",\n    storeAuthStateInCookie: true\n  }\n};\n\nconst scopes = [\n  'user.read',\n  'mailboxsettings.read',\n  'calendars.readwrite'\n]\n\nexport const scopeRequestConfig = {\n  scopes: SCOPES.split(',')\n}\n\nexport const azureProvider = new PublicClientApplication(MSAL_CONFIG);\n\nconst normalizeError = (error) => {\n  let normalizedError = {};\n\n  if (typeof (error) === 'string') {\n    const errParts = error.split('|');\n    normalizedError = errParts.length > 1 ?\n      {message: errParts[1], debug: errParts[0]} :\n      {message: error};\n  } else {\n    normalizedError = {\n      message: error.message,\n      debug: JSON.stringify(error)\n    };\n  }\n  return normalizedError;\n\n};\n\nconst isInteractionNeeded = (error) => {\n  if (!error.message || error.message.length <= 0) {\n    return false;\n  }\n\n  return (\n    error.message.indexOf('consent_required') > -1 ||\n    error.message.indexOf('interaction_required') > -1 ||\n    error.message.indexOf('login_required') > -1 ||\n    error.message.indexOf('no_account_in_silent_request') > -1\n  );\n};\n\nexport const getAccessToken = async (props) => {\n  console.log(props);\n  // try {\n  //   const silentResult = await azureProvider.acquireTokenSilent({\n  //     scopes: scopes,\n  //     account: account\n  //   });\n  //   return silentResult.accessToken;\n  // } catch (err) {\n  //   if (isInteractionNeeded(err)) {\n  //     const interactiveResult = await azureProvider.acquireTokenPopup({\n  //       scopes: scopes\n  //     });\n  //\n  //     return interactiveResult.accessToken;\n  //   } else {\n  //     throw err;\n  //   }\n  // }\n};\n\nexport const getUserProfile = async () => {\n  try {\n    const accessToken = await getAccessToken(scopes);\n    if (accessToken) {\n      return {\n        isAuthenticated: true,\n        user: {},\n        error: {message: \"Access token:\", debug: accessToken}\n      };\n    }\n  } catch (err) {\n    return {\n      isAuthenticated: false,\n      user: {},\n      error: normalizeError(err)\n    };\n  }\n};"]},"metadata":{},"sourceType":"module"}