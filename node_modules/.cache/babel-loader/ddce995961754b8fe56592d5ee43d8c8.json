{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rubenbernardes/Code/freelance/volvo/azure-context/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rubenbernardes/Code/freelance/volvo/azure-context/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/rubenbernardes/Code/freelance/volvo/azure-context/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import createDataContext from'../createDataContext';import{azureProvider,getAccessToken,getRolesFromParsedJwt,parseJwt}from'../../utils/security/security.util';var TYPES={ADD_ERROR:'auth/add_error',LOGIN:'auth/login',SIGN_OUT:'auth/signOut',CLEAR_ERROR:'auth/clearError',SET_USER:'auth/setUser'};var initialState={isAuthenticated:false,token:null,username:null,role:null,errorMessage:''};var authReducer=function authReducer(state,action){switch(action.type){case TYPES.ADD_ERROR:return _objectSpread(_objectSpread({},state),{},{errorMessage:action.payload});case TYPES.LOGIN:return{username:action.payload.name,isAuthenticated:true,errorMessage:'',token:action.payload.token,role:action.payload.role};case TYPES.CLEAR_ERROR:return _objectSpread(_objectSpread({},state),{},{errorMessage:''});case TYPES.SIGN_OUT:return initialState;case TYPES.SET_USER:return _objectSpread(_objectSpread({},state),{},{username:action.payload});default:return state;}};var signIn=function signIn(dispatch){return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getAccessToken,token,account,idToken,parsedJWT,userRole;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getAccessToken();case 2:_yield$getAccessToken=_context.sent;token=_yield$getAccessToken.token;account=_yield$getAccessToken.account;idToken=_yield$getAccessToken.idToken;parsedJWT=parseJwt(idToken);userRole=getRolesFromParsedJwt(parsedJWT);dispatch({type:TYPES.LOGIN,payload:{token:token,name:account.name,role:userRole}});case 9:case\"end\":return _context.stop();}}},_callee);}));};var signOut=function signOut(dispatch){return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return azureProvider.logout();case 2:dispatch({type:TYPES.SIGN_OUT});case 3:case\"end\":return _context2.stop();}}},_callee2);}));};var changeName=function changeName(dispatch){return function(){dispatch({type:TYPES.SET_USER,payload:'Ambrosio'});};};var _createDataContext=createDataContext(authReducer,{signIn:signIn,signOut:signOut,changeName:changeName},initialState),Provider=_createDataContext.Provider,Context=_createDataContext.Context;export{Provider,Context};","map":{"version":3,"sources":["/Users/rubenbernardes/Code/freelance/volvo/azure-context/src/context/auth/AuthContext.js"],"names":["createDataContext","azureProvider","getAccessToken","getRolesFromParsedJwt","parseJwt","TYPES","ADD_ERROR","LOGIN","SIGN_OUT","CLEAR_ERROR","SET_USER","initialState","isAuthenticated","token","username","role","errorMessage","authReducer","state","action","type","payload","name","signIn","dispatch","account","idToken","parsedJWT","userRole","signOut","logout","changeName","Provider","Context"],"mappings":"ygBAAA,MAAOA,CAAAA,iBAAP,KAA8B,sBAA9B,CACA,OAASC,aAAT,CAAwBC,cAAxB,CAAwCC,qBAAxC,CAA+DC,QAA/D,KAA+E,oCAA/E,CAEA,GAAMC,CAAAA,KAAK,CAAG,CACZC,SAAS,CAAE,gBADC,CAEZC,KAAK,CAAE,YAFK,CAGZC,QAAQ,CAAE,cAHE,CAIZC,WAAW,CAAE,iBAJD,CAKZC,QAAQ,CAAE,cALE,CAAd,CAQA,GAAMC,CAAAA,YAAY,CAAG,CACnBC,eAAe,CAAE,KADE,CAEnBC,KAAK,CAAE,IAFY,CAGnBC,QAAQ,CAAE,IAHS,CAInBC,IAAI,CAAE,IAJa,CAKnBC,YAAY,CAAE,EALK,CAArB,CAQA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,KAAD,CAAQC,MAAR,CAAmB,CACrC,OAAQA,MAAM,CAACC,IAAf,EACE,IAAKf,CAAAA,KAAK,CAACC,SAAX,CACE,sCAAWY,KAAX,MAAkBF,YAAY,CAAEG,MAAM,CAACE,OAAvC,GACF,IAAKhB,CAAAA,KAAK,CAACE,KAAX,CACE,MAAO,CAACO,QAAQ,CAAEK,MAAM,CAACE,OAAP,CAAeC,IAA1B,CAAgCV,eAAe,CAAE,IAAjD,CAAuDI,YAAY,CAAE,EAArE,CAAyEH,KAAK,CAAEM,MAAM,CAACE,OAAP,CAAeR,KAA/F,CAAsGE,IAAI,CAAEI,MAAM,CAACE,OAAP,CAAeN,IAA3H,CAAP,CACF,IAAKV,CAAAA,KAAK,CAACI,WAAX,CACE,sCAAWS,KAAX,MAAkBF,YAAY,CAAE,EAAhC,GACF,IAAKX,CAAAA,KAAK,CAACG,QAAX,CACE,MAAOG,CAAAA,YAAP,CACF,IAAKN,CAAAA,KAAK,CAACK,QAAX,CACE,sCAAWQ,KAAX,MAAkBJ,QAAQ,CAAEK,MAAM,CAACE,OAAnC,GACF,QACE,MAAOH,CAAAA,KAAP,CAZJ,CAcD,CAfD,CAiBA,GAAMK,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACC,QAAD,6EAAc,4NACatB,CAAAA,cAAc,EAD3B,4CACpBW,KADoB,uBACpBA,KADoB,CACbY,OADa,uBACbA,OADa,CACJC,OADI,uBACJA,OADI,CAErBC,SAFqB,CAETvB,QAAQ,CAACsB,OAAD,CAFC,CAGrBE,QAHqB,CAGVzB,qBAAqB,CAACwB,SAAD,CAHX,CAK3BH,QAAQ,CAAC,CACPJ,IAAI,CAAEf,KAAK,CAACE,KADL,CAEPc,OAAO,CAAE,CACPR,KAAK,CAALA,KADO,CAEPS,IAAI,CAAEG,OAAO,CAACH,IAFP,CAGPP,IAAI,CAAEa,QAHC,CAFF,CAAD,CAAR,CAL2B,sDAAd,IAAf,CAeA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACL,QAAD,6EAAc,+JACtBvB,CAAAA,aAAa,CAAC6B,MAAd,EADsB,QAG5BN,QAAQ,CAAC,CACPJ,IAAI,CAAEf,KAAK,CAACG,QADL,CAAD,CAAR,CAH4B,wDAAd,IAAhB,CAQA,GAAMuB,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACP,QAAD,QAAc,WAAM,CACrCA,QAAQ,CAAC,CACPJ,IAAI,CAAEf,KAAK,CAACK,QADL,CAEPW,OAAO,CAAE,UAFF,CAAD,CAAR,CAID,CALkB,EAAnB,C,uBAOmCrB,iBAAiB,CAClDiB,WADkD,CAElD,CAACM,MAAM,CAANA,MAAD,CAASM,OAAO,CAAPA,OAAT,CAAkBE,UAAU,CAAVA,UAAlB,CAFkD,CAGlDpB,YAHkD,C,CAAtCqB,Q,oBAAAA,Q,CAAUC,O,oBAAAA,O","sourcesContent":["import createDataContext from '../createDataContext';\nimport { azureProvider, getAccessToken, getRolesFromParsedJwt, parseJwt } from '../../utils/security/security.util';\n\nconst TYPES = {\n  ADD_ERROR: 'auth/add_error',\n  LOGIN: 'auth/login',\n  SIGN_OUT: 'auth/signOut',\n  CLEAR_ERROR: 'auth/clearError',\n  SET_USER: 'auth/setUser',\n};\n\nconst initialState = {\n  isAuthenticated: false,\n  token: null,\n  username: null,\n  role: null,\n  errorMessage: ''\n};\n\nconst authReducer = (state, action) => {\n  switch (action.type) {\n    case TYPES.ADD_ERROR:\n      return {...state, errorMessage: action.payload};\n    case TYPES.LOGIN:\n      return {username: action.payload.name, isAuthenticated: true, errorMessage: '', token: action.payload.token, role: action.payload.role};\n    case TYPES.CLEAR_ERROR:\n      return {...state, errorMessage: ''};\n    case TYPES.SIGN_OUT:\n      return initialState;\n    case TYPES.SET_USER:\n      return {...state, username: action.payload}\n    default:\n      return state;\n  }\n};\n\nconst signIn = (dispatch) => async () => {\n  const {token, account, idToken} = await getAccessToken();\n  const parsedJWT = parseJwt(idToken);\n  const userRole = getRolesFromParsedJwt(parsedJWT);\n\n  dispatch({\n    type: TYPES.LOGIN,\n    payload: {\n      token,\n      name: account.name,\n      role: userRole\n    }\n  });\n};\n\nconst signOut = (dispatch) => async () => {\n  await azureProvider.logout();\n\n  dispatch({\n    type: TYPES.SIGN_OUT\n  });\n};\n\nconst changeName = (dispatch) => () => {\n  dispatch({\n    type: TYPES.SET_USER,\n    payload: 'Ambrosio'\n  })\n}\n\nexport const {Provider, Context} = createDataContext(\n  authReducer,\n  {signIn, signOut, changeName},\n  initialState\n);\n"]},"metadata":{},"sourceType":"module"}